# üì¶ SquareSpace Orders Sheet ‚Äì Internal Documentation

This spreadsheet system helps track **guest ticket entries** and **automatically fetched Squarespace orders** for Oak City Shred Fest 5.

**Spreadsheet Link:** [SquareSpace Orders Sheet](https://docs.google.com/spreadsheets/d/1DHRi60WlDzO552H4BOdkJOqeyq-oaFaCiQhsSsSjX5s/edit?usp=sharing) (Access limited to authorized editors)

---

## üóÇÔ∏è Sheet Overview

### 1. **VIP Tab**

This is a manual entry sheet for special or transferred tickets not coming in through Squarespace.

**Columns:**

| Column Name          | Notes                                                             |
| -------------------- | ----------------------------------------------------------------- |
| (blank)              | Always left empty                                                 |
| `id`                 | **Must be unique** across all entries (used as unique identifier) |
| `Order ID`           | Arbitrary (for internal reference only)                           |
| `Order Number`       | Freeform, shown at the bottom of user‚Äôs ticket                    |
| `Created On`         | Date of entry; also shown on user‚Äôs ticket                        |
| `Name`               | Full name of the guest                                            |
| `Display Name`       | Auto-generated by formula (either `Override Name` or `Name`)      |
| `Customer Email`     | **Must be lowercase**                                             |
| `Fulfillment Status` | Optional (not currently used)                                     |
| `Product Name`       | Optional (not currently used)                                     |
| `Quantity`           | Optional (not currently used)                                     |
| `Unit Price`         | Optional (not currently used)                                     |
| `Subtotal`           | Optional (not currently used)                                     |
| `Grand Total`        | Optional (not currently used)                                     |
| `Count`              | Impacts total Tickets Sold ‚Äì used for headcount                   |

**Example Row:**

|     | id        | Order ID  | Order Number  | Created On | Name     | ... | Customer Email    | Fulfillment Status | Product Name | ... | Count |
| --- | --------- | --------- | ------------- | ---------- | -------- | --- | ----------------- | ------------------ | ------------ | --- | ----- |
|     | transfer1 | transfer1 | transfer 1468 | 4/16/2025  | John Doe | ... | johndoe@gmail.com | Event Pass...      |              | ... | 1     |

---

### 2. **Orders Tab**

This tab is **auto-filled by script** from the Squarespace API. **Do not manually edit** this sheet. Your changes will be overwritten.

**Key Behaviors:**

- Filters out irrelevant orders (not for OCSF 5) by number.
- Breaks down line items and expands per quantity (e.g., 2 tickets = 2 rows).
- Extracts names from item customizations (e.g., "Competitor's Name", "Guest 1", etc.).
- Infers fallback name from billing address if needed.
- Calculates ‚ÄúCount‚Äù only for tickets affecting headcount.
- Adds auto-generated Display Name using a formula.

---

## ‚öôÔ∏è Triggers & Automation

The following **Google Apps Script triggers** are connected:

### ‚è∞ `fetchSquareSpaceOrders` _(Time-based Trigger)_

- Runs periodically to pull new orders from Squarespace.
- Populates the **Orders** tab.
- Calls `syncToFirestore()` and `sumAllCounts()` afterward.

### ‚úçÔ∏è `syncToFireStoreOnEdit` _(On Edit Trigger)_

- Runs when changes are made in the **VIP** tab.
- Sends edited rows to Firebase (`Tickets-alpha3` collection).

### ‚ûï `sumAllCounts` _(Time-based Trigger)_

- Totals the `Count` column from both VIP and Orders sheets.
- Sends result to Firebase (`TicketsSold` collection).

---

## üîÑ Firestore Sync

All Firebase syncs go to the [Firebase Cloud Function](https://syncfirestore2-604117514059.us-central1.run.app) endpoint.

- `syncToFirestore()` ‚Üí Sends all rows from **Orders**
- `syncToFireStoreOnEdit()` ‚Üí Sends edited rows from **VIP**
- `sumAllCounts()` ‚Üí Sends combined ticket count

---

## üß† Notes & Best Practices

- **Always use lowercase** for emails in VIP tab.
- **Don‚Äôt duplicate `id` values** ‚Äì they must be globally unique.
- Columns L-N in VIP are currently **not in use**.
- `Order Number` and `Created On` are displayed on digital tickets.
- Manual additions in VIP must be **complete and accurate** for syncing.
- Never manually edit **Orders** tab ‚Äî it is overwritten during every sync.
